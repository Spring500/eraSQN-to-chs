@COM301
;てかげん
IF TEQUIP:高潮管理 == 0
	PRINTL てかげん
ELSE
	PRINTL てかげんを止める
ENDIF

CALL TRAIN_MESSAGE_B

SIF REFUSE_CHECK()
	RETURN 0

STR:0 = てかげん

IF TEQUIP:高潮管理
	CALL KOJO_MESSAGE_COM
	PREVCOM = 301

	RETURN 0
ENDIF

RETURN 1

@FLAG_COM301, ARG

@SOURCE_COM301, ARG
VARSET LOCAL

LOCAL:20 += 10
LOCAL:21 += 50

SIF NOWEX:Ｃ绝顶边缘
	LOCAL:0 = 100
SIF NOWEX:Ｖ绝顶边缘
	LOCAL:1 = 100
SIF NOWEX:Ａ绝顶边缘
	LOCAL:2 = 100
SIF NOWEX:Ｂ绝顶边缘
	LOCAL:17 = 100
SIF NOWEX:Ｍ绝顶边缘
	LOCAL:18 = 100

LOCAL:11 = 120
LOCAL:13 = 70
LOCAL:14 = 70

CALL CALC, "調教ソース", LOCAL:0, LOCAL:1, LOCAL:2, LOCAL:3, LOCAL:4, LOCAL:5, LOCAL:6, LOCAL:7, LOCAL:8, LOCAL:9, LOCAL:10, LOCAL:11, LOCAL:12, LOCAL:13, LOCAL:14, LOCAL:15, LOCAL:16, LOCAL:17, LOCAL:18, LOCAL:19, LOCAL:20, LOCAL:21, ARG


@TRAIN_MESSAGE_COM301
;押し倒され中？
IF TEQUIP:推到
	IF TEQUIP:高潮管理
		PRINTFORMW 主導権を%CALLNAME:TARGET%に奪われ、%CALLNAME:PLAYER%はこれ以上てかげんを続けることが出来ない…
		TEQUIP:高潮管理 = 0
	ENDIF
ELSE
	IF TEQUIP:高潮管理
		CALL ORGASM_ADD_A
		TEQUIP:高潮管理 = 0
		;フラート効果も終了
		TEQUIP:调情 = 0
		PRINTFORM %CALLNAME:PLAYER%は%CALLNAME:TARGET%へのてかげんを止め
		IF NOWEX:绝顶边缘合计数
			PRINTW て、焦らしていた場所を刺激した！
		ELSE
			PRINTW た…
		ENDIF
	ELSE
		PRINTFORMW %CALLNAME:PLAYER%は%CALLNAME:TARGET%を焦らすことにした…
		TEQUIP:高潮管理 = 1
	ENDIF
ENDIF


@EQUIP_COM31
;てかげん中
;てかげんしているターン数を記録
TEQUIP:高潮管理 += 1

RETURN 1

@EQUIP_COM31_2
;てかげん中
;手加減失敗判定
IF (TEQUIP:高潮管理 > ABL:PLAYER:技巧 + 1 || NOWEX:绝顶边缘合计数 > ABL:PLAYER:技巧) && RAND:(ABL:PLAYER:技巧 + 1) == 0
	PRINTL ＜てかげん失敗！＞
	TEQUIP:高潮管理 = 0
	RETURN 1
ENDIF
PRINTL ＜てかげん中＞

RETURN 1
