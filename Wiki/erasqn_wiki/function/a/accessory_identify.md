# @ACCESSORY_IDENTIFY

> [\[回Wiki首页\]](/Wiki) [\[回函数列表\]](/Wiki/erasqn_wiki/function/README.md)

### 作用描述

+ 鉴定饰品相关功能

### 所在文件

+ [Accessory_System.erb](/ERB/SHOP/Accessory_System.erb#L139-L216)

### 调用关系

**被调用**：

+ `@ACCESSORY_SHOP_BUY`<sup>[说明文件](/Wiki/erasqn_wiki/function/a/accessory_shop_buy.md)</sup>

**调用**：

+ `@ACCESSORY_ABL`<sup>[说明文件](/Wiki/erasqn_wiki/function/a/accessory_abl.md)</sup>

+ `PRINT_ACCESSORY`<sup>[说明文件](/Wiki/erasqn_wiki/function/p/print_accessory.md)</sup>

### 函数实现

#### 参数

+ ARG

+ ARGS

#### 返回值

无返回值

#### 功能实现

**L140**：

声明变量`LCOUNT`。

**L142-L147**：

（作用不明，过后研究）

（注释说的是判定要做什么）

（经过旧存档测试似乎第一次`LOCAL`必定为`7`，之后无论怎么循环都为`8`）

（经过新存档测试可以从`1`开始遍历，但超过`8`次后，`LOCAL`就会恒为`8`）

（此标志会被保存，所以……鉴定了`8`次之后一只都会是`8`）

用循环+判断造出`FLAG:310～390（仅整十）`中第一个为`0`的标志。

然后用`LOCAL`记录此标志，并立即跳出循环。

**L151-L163**：

当调用函数传入的`ARGS`为`鑑定`时，以引擎内置的随机数生成器生成`0～9`的随机数作为选择支，随机抽取饰品的等级

+ 当随机数为`0～5`时，什么都不做

+ 当随机数为`6`时，另`FLAG:(300 + LOCAL*10 + 9) += 1`

+ 当随机数为`7`时，另`FLAG:(300 + LOCAL*10 + 9) += 2`

+ 当随机数为`8`时，另`FLAG:(300 + LOCAL*10 + 9) += 3 + RAND:4`

+ 当随机数为`9`时，另`FLAG:(300 + LOCAL*10 + 9) += 4 + RAND:6`

**L166-L188**：

以被调用时传入的参数`ARG`（参考调用函数可知此值为要调用的物品，如手环、袖饰、宝石等）为选择支，随机抽取饰品的名称

+ 当`ARG`为`0`时，要鉴定的即为手环，将空着的已鉴定饰品记录槽`FLAG:(300 + LOCAL*10)`的值置为`ARG + RAND:4 + 1`

+ 当`ARG`为`0`时，要鉴定的即为袖饰，将空着的已鉴定饰品记录槽`FLAG:(300 + LOCAL*10)`的值置为`ARG + RAND:4 + 1`

+ 当`ARG`为`0`时，要鉴定的即为手套，将空着的已鉴定饰品记录槽`FLAG:(300 + LOCAL*10)`的值置为`ARG + RAND:4 + 1`

+ 当`ARG`为`0`时，要鉴定的即为绶带，将空着的已鉴定饰品记录槽`FLAG:(300 + LOCAL*10)`的值置为`ARG + RAND:4 + 1`

+ 当`ARG`为`0`时，要鉴定的即为指环，将空着的已鉴定饰品记录槽`FLAG:(300 + LOCAL*10)`的值置为`ARG + RAND:4 + 1`

+ 当`ARG`为`0`时，要鉴定的即为宝石，将空着的已鉴定饰品记录槽`FLAG:(300 + LOCAL*10)`的值置为`ARG`（宝石只有`龙石`这个描述，所以不需要用到随机数），且将`FLAG:(300 + LOCAL*10 + 9)`置为`0`，因为龙石的初始等级必须为`1`（覆盖上面抽的等级，难道是为了增加养成难度吗？）。

**L190-L191**：

输出鉴定的提示语的前面的部分。

**L194-L211**：

（作用不明，过后研究，这应该是要来随机生成饰品属性的步骤，注释说的是`2个以上的性能是低概率`？）

使用FOR循环，以`LCOUNT`记录迭代数，

+ 以`FLAG:(300 + LOCAL*10)/10`（饰品名称FLAG整除`10`）所得的结果作为选择支

  + 当结果为`5`时，则直接跳出循环

  + 当结果为`4`时

    + 在`LCOUNT`大于等于`3`且`RAND:(LCOUNT - 1)`大于`0`的情况下，直接跳出当前循环

  + 否则

    + 在`LCOUNT`大于等于`2`且`RAND:(LCOUNT)`大于`0`的情况下，直接跳出当前循环

然后调用`@ACCESSORY_ABL()`，并将随机生成的饰品素质储存到`FLAG:(300 + LOCAL*10 + LCOUNT)`归属于这个饰品的饰品槽属性FLAG中（可能为FLAG:3X1～3X5）。

**L214-L216**：

调用`@PRINT_ACCESSORY, LOCAL`，输出饰品属性。

打印鉴定提示结束的部分。
