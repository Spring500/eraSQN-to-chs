# @DAYEV

> [\[回Wiki首页\]](/Wiki) [\[回函数列表\]](/Wiki/erasqn_wiki/function/README.md)

### 作用描述

+ 日期判断

### 所在文件

+ [Function_Sq.erb](/ERB/TRAIN/Function_Sq.erb#L4100-L4335)

### 调用关系

**被调用**：

+ `@SHOW_SHOP`<sup>[说明文件](/Wiki/erasqn_wiki/function/s/show_shop.md)</sup>

**调用**：

+ `@CONFIG`<sup>[说明文件](/Wiki/erasqn_wiki/function/c/config.md)</sup>

+ `@USERSHOP`<sup>[说明文件](Wiki/erasqn_wiki/function/u/usershop.md)</sup>

### 函数实现

#### 参数

+ ARGS

+ ARGS:1

#### 返回值

返回值描述

#### 功能实现

L4103-L4122：定义一些存放现实日期的局部变量，如：RYEAR、MONTH_DAY、RDAY、RTIME、WEEKDAY

L4114：调用引擎内部函数`GETTIME`，此函数会将当前系统时间储存到`RESULT:0`，假如现在是2009年3月28日13時5分23秒678微妙，那么`RESULT:0`就等于`2009 03 28 13 05 23 678`（不包含空格）

L4116：`RYEAR = (RESULT / 100 00 00 00 00 000) % 10000` = 2009

L4118：`MONTH_DAY = (RESULT / 10000000) % 1000000` = 3 28 13

L4120：`RDAY = (RESULT / 1000000000) % 100` = 28

L4122：`RTIME = MONTH_DAY%100` = 13

L4125-L4130：

0=日， 1=一， 二=2， 3=三， 4=四， 5=五， 6=六

利用现实世界时间计算星期几，然后放到游戏里用，但似乎跟例子中的日子对不上，20090328应该是星期六，但算出来的结果为0，即周日。不过既然是游戏就不必太认真233。

一二月用以下的公式：

`WEEKDAY = (RYEAR - 1 + (RYEAR - 1)/4 - (RYEAR - 1)/100 + (RYEAR - 1)/400 + (13*(MONTH_DAY/10000 + 12) + 8)/5 + RDAY)%7`

其余月份用一下公式：

`WEEKDAY = (RYEAR + RYEAR/4 - RYEAR/100 + RYEAR/400 + (13*MONTH_DAY/10000 + 8)/5 + RDAY)%7`

L4135-L4193：通过`ARGS`传入要查询的节日，通过调用`CONFIG`判断是否要再现节庆日，以及`FLAG:871`。如果条件都满足，且日期刚好落在节庆日，就返回`1`

1月1日0点～1月2日3点：お正月

2月13日0点～2月13日23点：バレンタイン前日

2月14日0点～2月15日3点：バレンタイン

2月15日4点～2月16日3点：バレンタイン翌日

3月14日0点～3月15日3点：ホワイトデー

7月16日0点～7月17日3点：海の日

10月31日0点～11月1日3点：ハロウィン

12月18日0点～12月19日3点：クリスマス一週間前

12月24日0点～12月26日3点：クリスマス

12月18日0点～12月27日3点：クリスマス期間

12月26日4点～12月27日3点：クリスマス翌日

L4196-L4230：通过`ARGS`传入要查询的时间段（早朝、朝、昼、夜等），然后用`RTIME`判断，如果与要查询的时间段相同就返回`1`

4～5=早朝 4～10=朝 11～14=昼 13=昼下がり 17～20=夕方 20～23=夜 23～27=深夜

L4233-L4258：判断季节

3月1日0点～5月31日24点：春

5月1日0点～6月9日24点：初夏

6月1日0点～8月31日24点：夏

8月8日0点～9月6日24点：初秋

9月1日0点～11月31日24点：秋

11月1日0点～12月9日24点：晚秋

12月1日0点～14月31日24点：冬

L4261-L4333：判断`ARGS`星期几

如果`ARGS:1`指定了`ゲーム内`，则使用`(游戏内日期DAY - 1)%7 == ?`就算星期几，否则使用上面的计算`WEEKDAY`作为参照，如果符合就返回`1`，此外周末是指周六和周日